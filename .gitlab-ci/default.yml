default:
  image: $IMAGE

stages:
  - build
  - test

workflow:
  rules:
    - if: $CI_PIPELINE_SOURCE=="parent_pipeline"

build dumux:
  stage: build
  script:
    - dunecontrol --opts=$DUNE_OPTS_FILE --current all
    - dunecontrol --opts=$DUNE_OPTS_FILE --current make -k -j8 build_tests
  artifacts:
    paths:
      - build-cmake
    expire_in: 3 hours

test dumux:
  stage: test
  script:
    - cd build-cmake
    - dune-ctest -j8 --no-tests=error
  needs:
    - job: build dumux
      artifacts: true
  artifacts:
    reports:
      junit: junit/dumux-cmake.xml
